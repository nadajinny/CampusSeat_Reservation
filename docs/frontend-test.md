# 🧪 프런트엔드 테스트 가이드

프런트엔드 모듈은 DOM 없이도 실행 가능한 순수 로직을 최대한 `frontend/js/` 디렉터리에 모아 두었고, Jest로 해당 모듈을 단위 테스트합니다. 이 문서는 테스트 실행 방법과 현재 커버리지, 새로운 테스트를 추가할 때의 기준을 정리한 것입니다.

---

## 1. 테스트 환경

| 항목 | 설명 |
| --- | --- |
| 러너 | [Jest](https://jestjs.io) (CommonJS) |
| 위치 | `frontend/__tests__/*.test.js` |
| 엔트리 | `npm test` (`package.json`의 `jest --runInBand`) |
| Node 버전 | 18+ 권장 (Jest 30 호환) |

### 실행 예시

```bash
cd frontend
npm install        # 최초 1회
npm test           # 전체 테스트
npx jest reservation-engine.test.js --watch
```

테스트는 모두 순수 JS 로직만 다루므로 별도의 브라우저나 DOM 의존성이 없습니다. 실패 시 스택트레이스에 나온 파일(예: `frontend/js/reservation-engine.js`)을 바로 열어 수정하면 됩니다.

---

## 2. 폴더 구조와 네이밍

- `frontend/js/*.js` : 테스트 대상 모듈. DOM 접근 없이 순수 함수 형태로 유지합니다.
- `frontend/__tests__/*.test.js` : 모듈 당 하나의 테스트 파일을 두고, describe 블록으로 기능 영역을 나눕니다.
- 테스트 파일 이름은 가능한 한 대상 모듈 이름을 따라갑니다. (`reservation-engine.js` ↔ `reservation-engine.test.js`)
- 공통 빌더/헬퍼는 테스트 파일 상단에 함수로 정의하여 재사용합니다. 별도 헬퍼 파일이 필요하면 `frontend/__tests__/helpers/` 하위에 추가할 수 있습니다.

---

## 3. ReservationEngine 테스트 커버리지

`frontend/js/reservation-engine.js`는 회의실/열람실 예약 정책의 핵심 규칙을 담당하며, `frontend/__tests__/reservation-engine.test.js`에서 다음 세부 케이스를 검증합니다.

### 3-1. 회의실(`validateMeeting`) 테스트

| 케이스 | 목적 |
| --- | --- |
| 인증되지 않은 요청 거부 | `userId` 없이 호출 시 `AUTH_REQUIRED`가 반환되는지 확인 |
| 과거 날짜 거부 | `isPastDate` 경로를 통해 오래된 날짜 예약을 차단 |
| 참여자 최소 인원 | 참여자 3명 미만이면 실패 메시지 출력 |
| 참여자 학번 형식 | 9자리 숫자가 아닌 학번이 포함되면 실패 |
| 동일 사용자 중복 예약 | 같은 사용자·시간의 회의실 예약 시 충돌 메시지 |
| 다른 시설 시간 겹침 | 열람실 예약이 이미 있는 시간대와 겹치는지 검사 |
| 회의실 선점 여부 | 동일 회의실/시간에 다른 사용자가 예약했을 때 실패 |
| 일일 이용 한도 | 하루 2시간 초과 사용을 차단 |
| 주간 이용 한도 | 한 주에 5시간 초과한 경우 실패 |
| 참여자 정규화 | 공백·빈 문자열 제거 후 정제된 배열이 반환되는지 확인 |

### 3-2. 열람실 좌석(`validateSeat`) 테스트

| 케이스 | 목적 |
| --- | --- |
| 인증 필요 | 로그인하지 않은 상태에서 실패하는지 확인 |
| 시간대 선택 필수 | `slots`가 비어 있을 때 에러 메시지 확인 |
| 시간대 개수 제한 | 4시간(2개 슬롯) 초과 선택 시 거부 |
| 겹치는 슬롯 금지 | `slotsOverlap` 로직 검증 |
| 과거 날짜 거부 | 회의실과 동일하게 과거 예약 차단 |
| 운영 시간 검증 | 09~18시 외 슬롯 사용 시 실패 |
| 좌석 ID 필수 | 좌석 선택 누락 시 `SEAT_REQUIRED` 반환 |
| 좌석 선점 여부 | 같은 좌석/시간대가 이미 예약된 경우 거부 |
| 회의실과 중복 시간 | 다른 시설과의 시간 충돌 메시지 확인 |
| 일일 이용 한도 | 누적 4시간 초과 시 실패 |
| 유효한 예약 허용 | 정상 입력 시 `ok: true` 반환 여부 확인 |

새 규칙을 ReservationEngine에 추가할 때는, 동일 테스트 파일에 새 `test()`를 추가하고 **실패 케이스 → 성공 케이스** 순으로 서술하는 것을 원칙으로 합니다.

---

## 4. 새 테스트 작성 절차

1. **테스트 대상 분리**  
   DOM 조작 코드(`app.js` 등)는 테스트 친화적인 함수로 분리한 뒤 `module.exports`로 공개합니다.
2. **픽스처 정의**  
   `slot()`이나 `meetingReservation()`처럼 테스트 상단에 빌더 함수를 만들어 중복을 줄입니다.
3. **실패 조건 우선**  
   정책 문서나 기획서에 있는 예외 상황을 우선적으로 코드화합니다.
4. **성공 케이스 최소 1개**  
   happy path를 명시해 회귀 테스트 역할을 하도록 합니다.
5. **상태 최소화**  
   필요 이상의 예약 데이터/스토리지를 넣지 말고, 케이스마다 정확히 필요한 데이터만 구성합니다.

---

## 5. 자주 쓰는 패턴 & 팁

- **슬롯 빌더**  
  ```js
  const slot = (id, startHour, endHour) => ({
    id,
    startMinutes: startHour * 60,
    endMinutes: endHour * 60,
    label: `${String(startHour).padStart(2, "0")}:00 ~ ${String(endHour).padStart(2, "0")}:00`,
  });
  ```
  시간대 관련 정책이 많은 만큼, 빌더 함수를 재사용하면 테스트가 읽기 쉬워집니다.

- **예약 생성기**  
  `meetingReservation()`/`seatReservation()` 헬퍼를 그대로 복사하거나 import하여, 충돌 조건을 직관적으로 구성합니다.

- **정적 메서드 단독 테스트**  
  복잡한 로직(`slotsOverlap`, `getWeekRange`)은 필요한 경우 별도 describe로 분리해 직접 호출할 수 있습니다.

- **Watch 모드 활용**  
  `npm test -- --watch`로 실행하면 파일 저장 시 즉시 재실행되어 회귀 시간을 줄일 수 있습니다.

---

## 6. 문제 해결 체크리스트

- `Cannot find module` 오류 → `module.exports`가 빠졌거나 상대 경로가 잘못되었는지 확인합니다.
- 타임존 차이로 날짜 테스트가 흔들린다면, `Date` 객체 비교 전에 `setHours(0,0,0,0)` 처리를 동일하게 맞춥니다.
- 테스트가 너무 느릴 경우 `--runInBand` 옵션이 이미 적용되어 있으니, 데이터 픽스처 크기를 줄이거나 describe 블록을 `test.only`로 일시 제한합니다.

이 가이드를 따르면 프런트엔드 규칙이 코드와 테스트 모두에서 명확하게 유지되며, 향후 기능 추가 시 회귀를 빠르게 탐지할 수 있습니다.
