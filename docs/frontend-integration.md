# 🔌 백엔드 연동 체크리스트

FastAPI 레이어와 프런트가 싱크를 맞춰야 할 핵심 항목을 정리했습니다.  
각 항목을 개발 시작 전에 확인하고, 변경 사항이 생기면 관련 문서/코드/테스트를 함께 업데이트하세요.

---

## 1. 네트워크 환경

| 항목 | 요구 사항 | 참고 |
| --- | --- | --- |
| API 포트 | `http://127.0.0.1:8000` | `js/api-client.js`의 기본 상수와 FastAPI CORS 설정이 이 값에 맞춰져 있습니다. |
| 정적 서버 | `http://127.0.0.1:5500` | `python3 -m http.server 5500` 기준. 다른 포트를 쓰면 백엔드 CORS 화이트리스트에 추가해야 합니다. |
| 환경 오버라이드 | `window.APP_API_BASE_URL` | 실습/테스트 환경에서 다른 API Base URL을 사용하고 싶을 때 HTML에서 전역 변수를 설정합니다. |

---

## 2. 인증 & 세션 동기화

- **Access Token 필수**: FastAPI 엔드포인트가 JWT를 요구하는 경우, 프런트는 반드시 `sessionStorage.accessToken`을 보유해야 합니다. `ApiClient`는 모든 요청에 토큰을 자동 첨부하므로 별도의 처리 없이 일관된 인증을 보장합니다.
- **세션 만료 처리**: 서버가 401/403을 반환하면 `ApiClient.ApiError`가 throw되며, 화면에서는 로그인 화면으로 이동시키거나 사용자에게 재로그인을 안내해야 합니다.
- **로그아웃 연동**: 프런트에서 세션을 삭제한 후, 필요하다면 `/api/auth/logout` 같은 엔드포인트를 호출할 수 있도록 추가 구현을 고려합니다.

---

## 3. 데이터/정책 일치

1. **운영 시간 & 슬롯 단위**  
   - `js/app.js`의 `createSlots`와 백엔드의 운영시간 상수(`OperationHours`)가 동일해야 합니다.
   - 정책 변경 시 ReservationEngine, Jest 테스트, 문서(`docs/api.md`, `docs/frontend-storage.md`)를 한꺼번에 갱신하세요.

2. **에러 코드 & 메시지**  
   - 백엔드가 `code`, `payload.message`를 반환하면 프런트는 이를 사용자에게 그대로 보여주거나, 필요한 경우 번역 테이블을 두고 변환합니다.
   - `api-client.js`가 `ApiError`로 변환하므로, UI에서는 `error.message`만 신뢰해도 됩니다.

3. **예약 상태 값**  
   - `/api/reservations/me`가 반환하는 상태 문자열(`RESERVED`, `IN_USE`, …)과 프런트의 라벨/스타일 클래스가 동기화되어야 합니다. 새로운 상태가 추가되면 `my-reservations.html`의 `STATUS_LABELS`를 반드시 업데이트하세요.

---

## 4. 변경 관리

- **API 계약 변경 시**  
  문서(`docs/api.md`), `ApiClient` 함수, 화면 단에서의 파싱 로직을 모두 검토합니다.   
  예: `fetchSeatStatus` 응답 구조가 바뀌면 슬롯 렌더링, ReservationEngine 테스트까지 영향이 갑니다.

- **배포/환경 전환**  
  운영 환경이나 QA 환경의 도메인이 다르다면, `APP_API_BASE_URL`과 CORS 허용 목록이 모두 업데이트되었는지 확인합니다.  
  CI/CD에서 정적 자산을 서빙할 서버가 바뀌면 README와 docs에도 새 경로를 안내하세요.

---

## 5. 디버깅 팁

- 브라우저 개발자 도구의 Network 탭에서 요청/응답 헤더를 확인해 토큰이 누락되지 않았는지 먼저 검증합니다.
- 백엔드 로그를 통해 스케줄러나 상태 업데이트 로직이 제대로 동작하는지 확인하고, 프런트가 최신 상태를 표시하는지 교차 검증합니다.
- 오류 재현 시 `curl` 또는 `httpie`로 동일 요청을 만들어 백엔드가 기대한 응답을 내보내는지 독립적으로 테스트합니다.
